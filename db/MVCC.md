# MVCC

MVCC 可以保证不阻塞地读到一致的数据。

但是，MVCC 并没有对实现细节做约束，为此不同的数据库的语义有所不同，

    比如：
    postgres 是严格地无锁，对写操作也是乐观并发控制；
    在表中保存同一行数据记录的多个不同版本，每次写操作，都是创建，而回避更新；
    在事务提交时，按版本号检查当前事务提交的数据是否存在写冲突，存在则抛异常告知用户，回滚事务；

    innodb 则只对读无锁，写操作仍是上锁的悲观并发控制；
    这也意味着，innodb 中只能见到因死锁和不变性约束而回滚，而见不到因为写冲突而回滚；
    不像 postgres 那样对数据修改在表中创建新纪录，而是每行数据只在表中保留一份，在更新数据时上行锁，同时将旧版数据写入 undo log；
    表和 undo log 中行数据都记录着事务 ID，在检索时，只读取来自当前已提交的事务的行数据；

可见 MVCC 中的写操作仍可以按悲观并发控制实现，而 CAS (原子操作，比较和交换) 的写操作只能是乐观并发控制。

还有一个不同在于，MVCC 在语境中倾向于 “对多行数据打快照造平行宇宙”，然而 CAS 一般只是保护单行数据而已。比如 mongodb 有 CAS 的支持，但不能说这是 MVCC。

[来源](https://www.zhihu.com/question/27876575/answer/62496641)
