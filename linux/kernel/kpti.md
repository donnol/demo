# 内核分页表隔离 KPTI

Linux 内核中的一项加固技术，将用户空间(User Space)和内核空间(Kernel Space)的内存进行更好的隔离以增强安全

CPU 在用户态的时候，只能够访问内存映射表的映射出的虚拟地址，然后再被映射到实际物理地址。这个内存映射表是由 CPU 直接访问的、操作系统在核心态管理的，利用 CPU 本身的硬件特性就实现了应用程序的可访问内存区域隔离。

而这个 bug 就是这个机制有漏洞，可以有办法绕过，更新微代码不能解决，就只能操作系统内核通过软件实现了，操作系统内核要自己再维护一层内存映射表作为中间层、通过软件来控制权限。

KPTI: 分割页表，将现在被用户空间和内核空间共享使用的这张表分成两套，内核空间和用户空间各自使用一个

性能会降低 5%~30%

在现代系统中，页表是以一个树形结构进行组织的，这样可以高效地存储稀疏内存映射和支持巨页特性

页表，vma (虚拟内存区域)，AVL 树

[Intel 处理器 Bug](https://linux.cn/article-9202-1.html)
[KPTI](https://linux.cn/article-9201-1.html)
[页表](https://lwn.net/Articles/117749/)
